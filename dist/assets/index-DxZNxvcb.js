(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();console.log("Yahtzee game initializing...");const d={UPPER:[{id:"ones",name:"Ones",description:"Total of ones"},{id:"twos",name:"Twos",description:"Total of twos"},{id:"threes",name:"Threes",description:"Total of threes"},{id:"fours",name:"Fours",description:"Total of fours"},{id:"fives",name:"Fives",description:"Total of fives"},{id:"sixes",name:"Sixes",description:"Total of sixes"}],LOWER:[{id:"three_of_kind",name:"3 of a Kind",description:"Total of all dice"},{id:"four_of_kind",name:"4 of a Kind",description:"Total of all dice"},{id:"full_house",name:"Full House",description:"25 points"},{id:"small_straight",name:"Small Straight",description:"30 points"},{id:"large_straight",name:"Large Straight",description:"40 points"},{id:"yahtzee",name:"Yahtzee",description:"50 points"},{id:"chance",name:"Chance",description:"Total of all dice"}]};class m{constructor(){this.players=[],this.currentPlayerIdx=0,this.dice=[1,1,1,1,1],this.held=[!1,!1,!1,!1,!1],this.rollsLeft=3,this.round=1,this.history=JSON.parse(localStorage.getItem("yahtzee_history")||"[]"),this.canAddPlayers=!0,this.pendingScore=null,this.init()}init(){this.loadState()||this.setupNewGame(),this.setupTheme(),this.render(),this.bindEvents()}setupNewGame(){this.players=[this.createPlayer("P1"),this.createPlayer("P2")],this.currentPlayerIdx=0,this.canAddPlayers=!0,this.isWaitingForNext=!1,this.selectedCategory=null,this.pendingScore=null,this.rollsLeft=3,this.round=1,this.dice=[1,1,1,1,1],this.held=[!1,!1,!1,!1,!1],this.saveState()}createPlayer(e){const t={};return[...d.UPPER,...d.LOWER].forEach(r=>t[r.id]=null),{name:e,scores:t}}setupTheme(){const e=localStorage.getItem("yahtzee_theme");e?document.documentElement.setAttribute("data-theme",e):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.documentElement.setAttribute("data-theme","dark")}bindEvents(){document.getElementById("theme-btn").addEventListener("click",()=>{const t=document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark";document.documentElement.setAttribute("data-theme",t),localStorage.setItem("yahtzee_theme",t)}),document.getElementById("add-player-btn").addEventListener("click",()=>{this.canAddPlayers&&this.players.length<4&&(this.players.push(this.createPlayer(`P${this.players.length+1}`)),this.render(),this.saveState())}),document.getElementById("roll-btn").addEventListener("click",()=>this.rollDice()),document.getElementById("next-btn").addEventListener("click",()=>this.nextTurn()),document.getElementById("abandon-btn").addEventListener("click",()=>this.abandonGame()),document.getElementById("restart-btn").addEventListener("click",()=>this.restartGame())}abandonGame(){confirm("Are you sure you want to abandon this game? Current scores will be saved to history.")&&this.endGame()}restartGame(){confirm("Are you sure you want to discard this game and start over?")&&(localStorage.removeItem("yahtzee_state"),this.setupNewGame(),this.render())}resignPlayer(e){if(this.players.length<=2){alert("A game must have at least 2 players. You can abandon the game instead.");return}confirm(`Are you sure ${this.players[e].name} wants to resign?`)&&(this.players.splice(e,1),this.currentPlayerIdx>=this.players.length&&(this.currentPlayerIdx=0),this.render(),this.saveState())}rollDice(){if(this.rollsLeft===0||this.isRolling||this.isWaitingForNext)return;const e=800,t=300;if(this.isRolling=!0,this.rollingIndices=[],this.dice.forEach((n,i)=>{this.held[i]||this.rollingIndices.push(i)}),this.rollingIndices.length===0){this.isRolling=!1,this.rollsLeft--,this.render();return}this.render();const r=document.querySelectorAll(".die");let s=0;this.rollingIndices.forEach(n=>{const i=r[n],l=setInterval(()=>{i.dataset.value=Math.floor(Math.random()*6)+1},100),o=e+s*t;s++,setTimeout(()=>{clearInterval(l);const a=Math.floor(Math.random()*6)+1;this.dice[n]=a,this.rollingIndices=this.rollingIndices.filter(c=>c!==n),this.rollingIndices.length===0?setTimeout(()=>{this.isRolling=!1,this.rollsLeft--,this.saveState(),this.render()},150):(i.dataset.value=a,i.classList.remove("rolling"))},o)})}toggleDie(e){this.rollsLeft===3||this.isRolling||this.isWaitingForNext||(this.held[e]=!this.held[e],this.render())}saveState(){const e={players:this.players,currentPlayerIdx:this.currentPlayerIdx,dice:this.dice,held:this.held,rollsLeft:this.rollsLeft,round:this.round,canAddPlayers:this.canAddPlayers,isWaitingForNext:this.isWaitingForNext,pendingScore:this.pendingScore};localStorage.setItem("yahtzee_state",JSON.stringify(e))}loadState(){const e=localStorage.getItem("yahtzee_state");if(e){const t=JSON.parse(e);return Object.assign(this,t),this.rollingIndices=[],!0}return!1}render(){this.renderAvatars(),this.renderDice(),this.renderScoreboard(),this.renderHistory();const e=document.getElementById("roll-btn"),t=document.getElementById("next-btn");this.isWaitingForNext?(e.classList.add("hidden"),t.classList.remove("hidden")):(e.classList.remove("hidden"),t.classList.add("hidden"),e.textContent=this.isRolling?"Rolling...":`Roll Dice (${this.rollsLeft} left)`,e.disabled=this.rollsLeft===0||this.isRolling);const r=document.getElementById("add-player-btn");r&&(r.style.display=this.canAddPlayers&&this.players.length<4?"flex":"none")}renderAvatars(){const e=document.getElementById("player-avatars"),t=document.getElementById("add-player-btn");e.innerHTML="",this.players.forEach((r,s)=>{const n=document.createElement("div");n.className=`avatar p${s+1} ${s===this.currentPlayerIdx?"active":""}`,n.textContent=r.name;const i=document.createElement("div");i.className="resign-x",i.textContent="Ã—",i.title="Resign",i.addEventListener("click",l=>{l.stopPropagation(),this.resignPlayer(s)}),n.appendChild(i),e.appendChild(n)}),e.appendChild(t)}renderDice(){const e=document.getElementById("dice-container"),t=`
        <svg id="pips" width="114" height="114" viewBox="0 0 114 114" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="99" cy="99" r="15" data-pip="7"/>
        <circle cx="15" cy="99" r="15" data-pip="6"/>
        <circle cx="99" cy="57" r="15" data-pip="5"/>
        <circle cx="57" cy="57" r="15" data-pip="4"/>
        <circle cx="15" cy="57" r="15" data-pip="3"/>
        <circle cx="99" cy="15" r="15" data-pip="2"/>
        <circle cx="15" cy="15" r="15" data-pip="1"/>
        </svg>
        `;e.innerHTML="",this.dice.forEach((r,s)=>{const n=document.createElement("div"),i=(this.rollingIndices||[]).includes(s);n.className=`die ${this.held[s]?"held":""} ${i?"rolling":""}`,n.dataset.value=r,n.innerHTML=t,n.addEventListener("click",()=>this.toggleDie(s)),e.appendChild(n)})}renderScoreboard(){const e=document.getElementById("player-headers");e.innerHTML="<th>Category</th>",this.players.forEach((s,n)=>{const i=document.createElement("th");i.className=`player-col ${n===this.currentPlayerIdx?"active":""}`,i.textContent=s.name,e.appendChild(i)});const t=document.getElementById("score-rows");t.innerHTML="",this.renderSection(t,"Upper Section",d.UPPER),this.renderTotalRow(t,"Upper Total",s=>this.calculateUpperTotal(s.scores)),this.renderTotalRow(t,"Bonus (63+)",s=>this.calculateUpperBonus(s.scores)?35:0),this.renderSection(t,"Lower Section",d.LOWER);const r=document.getElementById("grand-total-row");r.innerHTML="<td>Grand Total</td>",this.players.forEach((s,n)=>{const i=document.createElement("td");i.className=n===this.currentPlayerIdx?"active-col footer-cell":"",i.textContent=this.calculateGrandTotal(s.scores),r.appendChild(i)})}renderSection(e,t,r){const s=document.createElement("tr");s.className="section-header",s.innerHTML=`<td colspan="${this.players.length+1}">${t}</td>`,e.appendChild(s),r.forEach(n=>{const i=document.createElement("tr");i.innerHTML=`<td>${n.name}</td>`,this.players.forEach((l,o)=>{const a=document.createElement("td"),c=l.scores[n.id];if(a.className=`score-cell ${c!==null?"filled":""} ${o===this.currentPlayerIdx?"active-col":""}`,a.textContent=c!==null?c:"-",o===this.currentPlayerIdx&&c===null&&this.rollsLeft<3){const h=this.calculatePotentialScore(n.id,this.dice);this.pendingScore&&this.pendingScore.catId===n.id?(a.textContent=this.pendingScore.score,a.classList.add("filled")):(a.textContent=h,a.classList.add("preview")),a.addEventListener("click",()=>this.selectScore(n.id,h))}i.appendChild(a)}),e.appendChild(i)})}renderTotalRow(e,t,r){const s=document.createElement("tr");s.className="total-row",s.innerHTML=`<td>${t}</td>`,this.players.forEach(n=>{const i=document.createElement("td");i.textContent=r(n),s.appendChild(i)}),e.appendChild(s)}renderHistory(){const e=document.getElementById("history-rows");e.innerHTML="",[...this.history].reverse().forEach((t,r)=>{const s=document.createElement("tr");s.innerHTML=`<td>Game ${this.history.length-r}</td>`;const n=Math.max(...Object.values(t));this.players.forEach(i=>{const l=document.createElement("td"),o=t[i.name]||0;l.textContent=o,o===n&&o>0&&l.classList.add("winner"),s.appendChild(l)}),e.appendChild(s)})}selectScore(e,t){this.pendingScore={catId:e,score:t},this.isWaitingForNext=!0,this.saveState(),this.render()}nextTurn(){this.pendingScore&&(this.players[this.currentPlayerIdx].scores[this.pendingScore.catId]=this.pendingScore.score,this.pendingScore=null),this.isWaitingForNext=!1,this.held=[!1,!1,!1,!1,!1],this.rollsLeft=3,this.dice=[1,1,1,1,1],this.currentPlayerIdx++,this.currentPlayerIdx>=this.players.length&&(this.currentPlayerIdx=0,this.canAddPlayers&&(this.canAddPlayers=!1),this.round++),this.round>13?this.endGame():(this.saveState(),this.render())}endGame(){const e={};this.players.forEach(t=>{e[t.name]=this.calculateGrandTotal(t.scores)}),this.history.push(e),localStorage.setItem("yahtzee_history",JSON.stringify(this.history)),alert("Game Over!"),localStorage.removeItem("yahtzee_state"),this.setupNewGame(),this.render()}calculatePotentialScore(e,t){const r=this.getCounts(t);switch(e){case"ones":return r[1]*1;case"twos":return r[2]*2;case"threes":return r[3]*3;case"fours":return r[4]*4;case"fives":return r[5]*5;case"sixes":return r[6]*6;case"three_of_kind":return this.hasCount(r,3)?this.sum(t):0;case"four_of_kind":return this.hasCount(r,4)?this.sum(t):0;case"full_house":return this.hasCount(r,3)&&this.hasCount(r,2)?25:0;case"small_straight":return this.hasStraight(t,4)?30:0;case"large_straight":return this.hasStraight(t,5)?40:0;case"yahtzee":return this.hasCount(r,5)?50:0;case"chance":return this.sum(t);default:return 0}}getCounts(e){const t={1:0,2:0,3:0,4:0,5:0,6:0};return e.forEach(r=>t[r]=(t[r]||0)+1),t}hasCount(e,t){return Object.values(e).some(r=>r>=t)}sum(e){return e.reduce((t,r)=>t+r,0)}hasStraight(e,t){const r=[...new Set(e)].sort();let s=1,n=1;for(let i=0;i<r.length-1;i++)r[i+1]===r[i]+1?s++:s=1,n=Math.max(n,s);return n>=t}calculateUpperTotal(e){return d.UPPER.reduce((t,r)=>t+(e[r.id]||0),0)}calculateUpperBonus(e){return this.calculateUpperTotal(e)>=63}calculateGrandTotal(e){const t=this.calculateUpperTotal(e),r=t>=63?35:0,s=d.LOWER.reduce((n,i)=>n+(e[i.id]||0),0);return t+r+s}}window.addEventListener("DOMContentLoaded",()=>{window.game=new m});
